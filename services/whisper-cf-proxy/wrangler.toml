name = "vomeet-whisper-proxy"
main = "src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]
account_id = "e969f68535cd92a6482a7b34a6a5d74b"  # Voltade account

# R2 bucket for audio storage
[[r2_buckets]]
binding = "AUDIO_BUCKET"
bucket_name = "vomeet-audio"

# Queue for async transcription
[[queues.producers]]
queue = "transcription-queue"
binding = "TRANSCRIPTION_QUEUE"

[[queues.consumers]]
queue = "transcription-queue"
max_batch_size = 1
max_batch_timeout = 30
max_retries = 3

# Queue for webhook delivery (separate from transcription)
[[queues.producers]]
queue = "webhook-queue"
binding = "WEBHOOK_QUEUE"

[[queues.consumers]]
queue = "webhook-queue"
max_batch_size = 5
max_batch_timeout = 10
max_retries = 10
dead_letter_queue = "webhook-dlq"

# AI binding
[ai]
binding = "AI"

# Environment variables (non-sensitive)
[vars]
# Set VOMEET_WEBHOOK_URL via: wrangler secret put VOMEET_WEBHOOK_URL
# Example: https://vomeet.io/transcripts/webhook

# Durable Objects for WebSocket state
[[durable_objects.bindings]]
name = "WHISPER_SESSION"
class_name = "WhisperSession"

[[migrations]]
tag = "v1"
new_classes = ["WhisperSession"]
